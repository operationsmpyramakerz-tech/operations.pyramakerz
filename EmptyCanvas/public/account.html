<!DOCTYPE html>


<html lang="en">
<head>
  <link rel="manifest" href="/manifest.webmanifest" />
<meta name="theme-color" content="#ffffff" />

<link rel="icon" href="/icons/icon-192.png" />
<link rel="apple-touch-icon" href="/icons/icon-192.png" />

<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="mobile-web-app-capable" content="yes" />

<script src="/pwa-register.js" defer></script>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Account Info</title>
<link href="/css/style.css" rel="stylesheet"/>
<link href="/css/ui-redesign.css" rel="stylesheet"/>
<style>
  /* ðŸ”’ Critical: prevent sidebar links flash before permissions load */
  body.permissions-loading .sidebar li { display: none !important; }
</style>

<!-- Account page: match "Settled my account" mini-window styling + smaller edit button -->
<style>
  /* Smaller edit icon button (transparent background) */
  .acc-action.acc-edit{
    width: 26px !important;
    height: 26px !important;
    padding: 0 !important;
    border: none !important;
    background: transparent !important;
    border-radius: 10px !important;
  }
  .acc-action.acc-edit:hover{
    background: transparent !important;
    opacity: 0.85;
  }
  .acc-action.acc-edit svg{ width: 15px; height: 15px; }

  /* ============================
     Modal styling (same as Expenses "Settled my account")
     ============================ */
  .ex-modal{
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.45);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 9999;
  }
  .ex-modal-box{
    background: white;
    padding: 1.8rem;
    width: 90%;
    max-width: 420px;
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
  }
  .ex-modal-title{
    font-size: 1.4rem;
    font-weight: 700;
    margin-bottom: 1rem;
  }
  .ex-input{
    width: 100%;
    padding: 0.8rem;
    border-radius: 12px;
    border: 1.5px solid #d1d5db;
    margin-bottom: 1rem;
    font-size: 1rem;
    background: #fff;
  }
  .ex-modal-actions{
    display: flex;
    justify-content: space-between;
    margin-top: 1rem;
  }
  .ex-btn{
    padding: 0.7rem 1.4rem;
    border-radius: 12px;
    border: none;
    cursor: pointer;
    font-weight: 600;
  }
  .ex-primary{ background: #3b82f6; color: white; }
  .ex-danger{ background: #ef4444; color: white; }

  /* Inline error message inside modal */
  .ex-error{
    display: none;
    margin-top: -0.5rem;
    margin-bottom: 0.8rem;
    color: #B91C1C;
    font-weight: 700;
    font-size: 0.95rem;
  }


  /* Label row with icon (like expenses modals) */
  .field-label{
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-weight: 700;
    color: #111;
    margin-top: 0.6rem;
    margin-bottom: 0.25rem;
  }
  .field-label svg{ width: 16px; height: 16px; }

</style>
<script src="https://unpkg.com/feather-icons"></script>
</head>
<body class="permissions-loading">
<script>
    (function() {
      try {
        if (window.innerWidth > 768 && localStorage.getItem('ui.sidebarMini') === '1') {
          document.body.classList.add('sidebar-mini');
        }
      } catch(e) {}
    })();
  </script>
<div class="app-container">
<aside class="sidebar">
<div class="sidebar-header">
<h2>Dashboard</h2>
<button aria-expanded="true" aria-label="Toggle sidebar" class="sidebar-toggle" id="sidebar-toggle">
<i data-feather="chevrons-left"></i>
</button>
</div>
<!-- Sidebar: flat links -->
<nav class="sidebar-nav">
<ul class="nav-list">
<li>
<a class="nav-link" href="/orders">
<i data-feather="list"></i>
<span class="nav-label">Current Orders</span>
</a>
</li>
<li>
<a class="nav-link" href="/orders/requested">
<i data-feather="users"></i>
<span class="nav-label">Operations Orders</span>
</a>
</li>
<li>
<a class="nav-link" href="/orders/new">
<i data-feather="plus-circle"></i>
<span class="nav-label">Create New Order</span>
</a>
</li>
<li>
<a class="nav-link" href="/stocktaking">
<i data-feather="archive"></i>
<span class="nav-label">Stocktaking</span>
</a>
</li>
<li>
  <a class="nav-link" href="/orders/sv-orders">
    <i data-feather="award"></i>
    <span class="nav-label">S.V schools orders</span>
  </a>
</li>
        <li><a class="nav-link" href="/expenses"><i data-feather="dollar-sign"></i><span class="nav-label">Expenses</span></a></li>
        <li><a class="nav-link" href="/expenses/users"><i data-feather="users"></i><span class="nav-label">Expenses by User</span></a></li>
</ul>
</nav>
<div class="sidebar-footer">
<button class="logout-btn" id="logoutBtn"><i data-feather="log-out"></i> Logout</button>
</div>
</aside>
<div class="main-content">
<header class="main-header">
<div class="header-row1">
<div class="left">
<div aria-live="polite" class="greeting-pill">
<span class="greeting-avatar">
<img alt="Hi icon" src="/images/greeting-icon.png"/>
</span>
<div class="greet-text">
<div class="greet-title">Hi, <span data-username="">...</span> ðŸ‘‹</div>
<div class="greet-sub">Start your day with operations</div>
</div>
</div>
</div>
<div class="right topbar-right">
<a aria-label="My account" class="account-mini" href="/account" title="My account">
<span class="ico-circle"><img alt="Logo" src="/images/logo.png"/></span>
<span class="label">My account</span>
</a>
</div>
</div>
<div class="header-row2">
<h1 class="page-title">Account Info</h1>
</div>
</header>
<main class="container-full-width">
<section class="card">
<div id="account-content">
<p><i class="loading-icon" data-feather="loader"></i> Loading account...</p>
</div>
</section>
</main>
</div>
</div>

<!-- ACCOUNT EDIT MODAL (same style as Expenses "Settled my account") -->
<div id="accountEditModal" class="ex-modal" aria-hidden="true">
  <div class="ex-modal-box" role="dialog" aria-modal="true" aria-labelledby="accountEditTitle">
    <h3 class="ex-modal-title" id="accountEditTitle">Edit</h3>

    <label class="field-label" id="accountEditValueLabel"><i data-feather="edit-3"></i> Value</label>
    <input id="accountEditValue" type="text" class="ex-input" />

    <label class="field-label" id="accountEditPasswordLabel"><i data-feather="lock"></i> Current password</label>
    <input id="accountEditPassword" type="password" class="ex-input" inputmode="numeric" autocomplete="current-password" />

    <div id="accountEditError" class="ex-error" role="alert">invalid password</div>

    <div class="ex-modal-actions">
      <button id="accountEditSubmit" class="ex-btn ex-primary" type="button">Submit</button>
      <button id="accountEditClose" class="ex-btn ex-danger" type="button">Close</button>
    </div>
  </div>
</div>

<!-- ACCOUNT SAVING OVERLAY -->
<div id="accountSavingOverlay" class="ex-modal" aria-hidden="true" style="display:none;">
  <div class="ex-modal-box" role="status" aria-live="polite" style="max-width: 320px; text-align:center;">
    <h3 class="ex-modal-title" style="margin-bottom:0.75rem;">Saving...</h3>
    <p style="margin:0; display:flex; align-items:center; justify-content:center; gap:10px;">
      <i class="loading-icon" data-feather="loader"></i>
      <span>Please wait</span>
    </p>
  </div>
</div>

    <script>feather.replace();</script>
<script src="/js/common-ui.js"></script>
<script src="/js/script.js"></script>
<script src="/js/account.js"></script>
    <script>
(() => {
  const GROUP_KEY = 'ui.sidebar.nrr.open';
  const group = document.querySelector('.nav-group[data-group="nrr"]');
  if (!group) return;

  const toggle = group.querySelector('.nav-group-toggle');
  const sub    = group.querySelector('.nav-sub');

  function setOpen(open) {
    group.classList.toggle('is-open', open);
    toggle.setAttribute('aria-expanded', String(open));
    // animate height
    if (sub) sub.style.maxHeight = open ? sub.scrollHeight + 'px' : '0px';
    try { localStorage.setItem(GROUP_KEY, open ? '1' : '0'); } catch {}
  }

  // open if saved OR if current page is the NRR page
  const saved = (() => { try { return localStorage.getItem(GROUP_KEY) === '1'; } catch { return false; }})();
  const onNRR = location.pathname.endsWith('/new-report-request.html');
  setOpen(saved || onNRR);

  toggle.addEventListener('click', (e) => {
    e.preventDefault();
    setOpen(!group.classList.contains('is-open'));
  });

  // highlight active sub item by ?view=
  const params = new URLSearchParams(location.search);
  const view = params.get('view') || 'request';
  group.querySelectorAll('.nav-sublink').forEach(a => {
    const isActive = a.getAttribute('href')?.endsWith('view=' + view);
    a.classList.toggle('active', !!isActive);
  });

  // keep feather icons updated
  if (window.feather) feather.replace();

  // keep height correct if fonts load / window resizes
  window.addEventListener('resize', () => {
    if (group.classList.contains('is-open')) {
      sub.style.maxHeight = sub.scrollHeight + 'px';
    }
  });
})();
</script>

    </body>

</html>
