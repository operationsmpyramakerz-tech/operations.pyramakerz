<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="manifest" href="/manifest.webmanifest" />
  <meta name="theme-color" content="#ffffff" />

  <link rel="icon" href="/icons/icon-192.png" />
  <link rel="apple-touch-icon" href="/icons/icon-192.png" />

  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="mobile-web-app-capable" content="yes" />

  <script src="/pwa-register.js" defer></script>

  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Tasks</title>

  <!-- CRITICAL: Prevent sidebar links flash before CSS/permissions load -->
  <style>
    body.permissions-loading .sidebar li { display: none !important; }
  </style>

  <link href="/css/style.css" rel="stylesheet"/>
  <link href="/css/tasks.css" rel="stylesheet"/>
  <script src="https://unpkg.com/feather-icons"></script>
</head>

<body class="permissions-loading tasks-v2">
  <script>
    (function() {
      try {
        if (window.innerWidth > 768 && localStorage.getItem('ui.sidebarMini') === '1') {
          document.body.classList.add('sidebar-mini');
        }
      } catch(e) {}
    })();
  </script>

  <div class="app-container">
    <aside class="sidebar">
      <div class="sidebar-header">
        <h2>Dashboard</h2>
        <button aria-expanded="true" aria-label="Toggle sidebar" class="sidebar-toggle" id="sidebar-toggle">
          <i data-feather="chevrons-left"></i>
        </button>
      </div>

      <nav class="sidebar-nav">
        <ul class="nav-list">
          <li><a class="nav-link" href="/orders"><i data-feather="list"></i><span class="nav-label">Current Orders</span></a></li>
          <li><a class="nav-link" href="/orders/requested"><i data-feather="users"></i><span class="nav-label">Operations Orders</span></a></li>
          <li><a class="nav-link" href="/orders/new"><i data-feather="plus-circle"></i><span class="nav-label">Create New Order</span></a></li>
          <li><a class="nav-link" href="/stocktaking"><i data-feather="archive"></i><span class="nav-label">Stocktaking</span></a></li>
          <li><a class="nav-link active" href="/tasks"><i data-feather="check-square"></i><span class="nav-label">Tasks</span></a></li>
          <li><a class="nav-link" href="/b2b"><i data-feather="folder"></i><span class="nav-label">B2B</span></a></li>
          <li><a class="nav-link" href="/logistics"><i data-feather="truck"></i><span class="nav-label">Logistics</span></a></li>
          <li><a class="nav-link" href="/damaged-assets"><i data-feather="alert-triangle"></i><span class="nav-label">Damaged Assets</span></a></li>
          <li><a class="nav-link" href="/orders/sv-orders"><i data-feather="award"></i><span class="nav-label">S.V schools orders</span></a></li>
          <li><a class="nav-link" href="/expenses"><i data-feather="dollar-sign"></i><span class="nav-label">Expenses</span></a></li>
          <li><a class="nav-link" href="/expenses/users"><i data-feather="users"></i><span class="nav-label">Expenses by User</span></a></li>
        </ul>
      </nav>

      <div class="sidebar-footer">
        <button class="logout-btn" id="logoutBtn"><i data-feather="log-out"></i> Logout</button>
      </div>
    </aside>

    <div class="main-content">
      <main class="tasks-v2-main">
        <div class="tasks-v2-shell">
          <div class="tasks-v2-panels">

            <!-- Left screen (calendar + tasks list) -->
            <section class="tasks-v2-panel tasks-v2-panel--list" aria-label="Tasks">
              <div class="tasks-v2-hero">
                <div class="tasks-v2-topbar">
                  <button class="tasks-v2-icon-btn" type="button" aria-label="Open menu" id="tasksV2MenuBtn">
                    <i data-feather="menu"></i>
                  </button>

                  <a class="tasks-v2-profile" href="/account" aria-label="My account">
                    <img src="/images/logo.png" alt="" />
                  </a>
                </div>

                <button class="tasks-v2-month" type="button" aria-label="Select month">
                  <span>March</span>
                  <i data-feather="chevron-down"></i>
                </button>

                <div class="tasks-v2-calendar" aria-label="Calendar">
                  <div class="tasks-v2-weekdays" aria-hidden="true">
                    <span>Sun</span><span>Mon</span><span>Tue</span><span>Wed</span><span>Thu</span><span>Fri</span><span>Sat</span>
                  </div>
                  <div class="tasks-v2-days" role="tablist" aria-label="Select day">
                    <button class="tasks-v2-day" type="button" role="tab" aria-selected="false">12</button>
                    <button class="tasks-v2-day" type="button" role="tab" aria-selected="false">13</button>
                    <button class="tasks-v2-day" type="button" role="tab" aria-selected="false">14</button>
                    <button class="tasks-v2-day" type="button" role="tab" aria-selected="false">15</button>
                    <button class="tasks-v2-day is-active" type="button" role="tab" aria-selected="true">16</button>
                    <button class="tasks-v2-day" type="button" role="tab" aria-selected="false">17</button>
                    <button class="tasks-v2-day" type="button" role="tab" aria-selected="false">18</button>
                  </div>
                </div>
              </div>

              <div class="tasks-v2-list" id="tasksGrid">
                <!-- Highlight card -->
                <article class="tv2-highlight" aria-label="Team Meeting">
                  <div class="tv2-highlight__txt">
                    <div class="tv2-highlight__title">Team Meeting</div>
                    <div class="tv2-highlight__sub">Discussing the project with the team</div>
                  </div>
                  <div class="tv2-circle tv2-circle--dark" aria-hidden="true">
                    <i data-feather="check"></i>
                  </div>
                </article>

                <!-- Card 1 -->
                <article class="tv2-card" aria-label="One-to-one">
                  <div class="tv2-card__top">
                    <div class="tv2-time">12:00–1:00 PM</div>
                    <div class="tv2-avatars" aria-hidden="true">
                      <span class="tv2-avatar tv2-avatar--a">A</span>
                      <span class="tv2-avatar tv2-avatar--b">B</span>
                    </div>
                  </div>

                  <div class="tv2-card__title">One-to-one</div>
                  <div class="tv2-card__sub">Repeats every two weeks</div>

                  <div class="tv2-card__bottom">
                    <div class="tv2-tags" aria-hidden="true">
                      <span class="tv2-tag">Today</span>
                      <span class="tv2-tag">1h</span>
                    </div>
                    <button class="tv2-circle tv2-circle--dark" type="button" aria-label="Open">
                      <i data-feather="arrow-up-right"></i>
                    </button>
                  </div>
                </article>

                <!-- Card 2 -->
                <article class="tv2-card" aria-label="PM Meeting">
                  <div class="tv2-card__top">
                    <div class="tv2-time">1:00–2:30 PM</div>
                    <div class="tv2-avatars" aria-hidden="true">
                      <span class="tv2-avatar tv2-avatar--c">C</span>
                      <span class="tv2-avatar tv2-avatar--d">D</span>
                      <span class="tv2-avatar tv2-avatar--e">E</span>
                      <span class="tv2-avatar-more">+7</span>
                    </div>
                  </div>

                  <div class="tv2-card__title">PM Meeting</div>
                  <div class="tv2-card__sub">Discussion of tasks for the month</div>

                  <div class="tv2-card__bottom">
                    <div class="tv2-tags" aria-hidden="true">
                      <span class="tv2-tag">Today</span>
                      <span class="tv2-tag">1h 30m</span>
                    </div>
                    <button class="tv2-circle tv2-circle--dark" type="button" aria-label="Open">
                      <i data-feather="arrow-up-right"></i>
                    </button>
                  </div>
                </article>

              </div>
            </section>

            <!-- Right screen (details) -->
            <section class="tasks-v2-panel tasks-v2-panel--detail" aria-label="Task details">
              <div class="tasks-v2-sheet">
                <div class="tasks-v2-sheet__top">
                  <button class="tasks-v2-icon-btn tasks-v2-icon-btn--light" type="button" aria-label="Close">
                    <i data-feather="x"></i>
                  </button>

                  <button class="tasks-v2-icon-btn tasks-v2-icon-btn--light" type="button" aria-label="Edit">
                    <i data-feather="edit-2"></i>
                  </button>
                </div>

                <div class="tasks-v2-time-pill">1:00–2:30 PM</div>

                <h2 class="tasks-v2-detail-title" id="taskDetailTitle">PM Meeting</h2>
                <p class="tasks-v2-detail-sub">Discussion of tasks for the month</p>

                <div class="tv2-avatars tv2-avatars--center" aria-label="Participants">
                  <span class="tv2-avatar tv2-avatar--c">C</span>
                  <span class="tv2-avatar tv2-avatar--d">D</span>
                  <span class="tv2-avatar tv2-avatar--e">E</span>
                  <span class="tv2-avatar-more">+7</span>
                </div>

                <div class="tasks-v2-plan-heading">Plan</div>

                <div class="tv2-plan" id="taskDetailBody">
                  <div class="tv2-plan-item tv2-plan-item--active">
                    <div class="tv2-plan-item__txt">Discussion of the brief from the customer</div>
                    <div class="tv2-plan-item__time">1:00–1:30</div>
                  </div>

                  <div class="tv2-plan-item">
                    <div class="tv2-plan-item__txt">Assignment of roles in the team</div>
                    <div class="tv2-plan-item__time">1:30–2:00</div>
                  </div>

                  <div class="tv2-plan-item">
                    <div class="tv2-plan-item__txt">Summarising the results of the meeting</div>
                    <div class="tv2-plan-item__time">2:00–2:30</div>
                  </div>
                </div>
              </div>
            </section>

          </div>
        </div>
      </main>
    </div>
  </div>

  <script>
    // Sidebar toggle for the custom header hamburger
    document.addEventListener('DOMContentLoaded', () => {
      const btn = document.getElementById('tasksV2MenuBtn');
      if (!btn) return;
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        document.body.classList.toggle('sidebar-collapsed');
      });
    });
  </script>

  <script>feather.replace();</script>
  <script src="/js/common-ui.js"></script>
</body>
</html>
