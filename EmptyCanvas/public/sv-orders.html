<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="manifest" href="/manifest.webmanifest" />
<meta name="theme-color" content="#ffffff" />

<link rel="icon" href="/icons/icon-192.png" />
<link rel="apple-touch-icon" href="/icons/icon-192.png" />

<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="mobile-web-app-capable" content="yes" />

<script src="/pwa-register.js" defer></script>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>S.V schools orders</title>
  <!-- CRITICAL: Prevent sidebar links flash before CSS/permissions load -->
  <style>
    body.permissions-loading .sidebar li { display: none !important; }
  </style>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css"/>
  <link rel="stylesheet" href="/css/style.css"/>
  <link href="/css/ui-redesign.css" rel="stylesheet"/>
  <script src="https://unpkg.com/feather-icons"></script>
</head>
<body class="permissions-loading">
  <script>
    (function () {
      try {
        if (window.innerWidth > 768 && localStorage.getItem('ui.sidebarMini') === '1') {
          document.body.classList.add('sidebar-mini');
        }
      } catch (e) {}
    })();
  </script>

  <div class="app-container">
    <aside class="sidebar">
      <div class="sidebar-header">
        <h2>Dashboard</h2>
        <button id="sidebar-toggle" class="sidebar-toggle" aria-label="Toggle sidebar" aria-expanded="true">
          <i data-feather="chevrons-left"></i>
        </button>
      </div>

      <nav class="sidebar-nav">
        <ul class="nav-list">
          <li><a class="nav-link" href="/orders"><i data-feather="list"></i><span class="nav-label">Current Orders</span></a></li>
        <li><a class="nav-link" href="/orders/requested"><i data-feather="users"></i><span class="nav-label">Operations Orders</span></a></li>
        <li><a class="nav-link" href="/orders/new"><i data-feather="plus-circle"></i><span class="nav-label">Create New Order</span></a></li>
        <li><a class="nav-link" href="/stocktaking"><i data-feather="archive"></i><span class="nav-label">Stocktaking</span></a></li>
        <li><a class="nav-link active" href="/orders/sv-orders"><i data-feather="award"></i><span class="nav-label">S.V schools orders</span></a></li>
        <li><a class="nav-link" href="/expenses"><i data-feather="dollar-sign"></i><span class="nav-label">Expenses</span></a></li>
        <li><a class="nav-link" href="/expenses/users"><i data-feather="users"></i><span class="nav-label">Expenses by User</span></a></li>
</ul>
      </nav>

      <div class="sidebar-footer">
        <button id="logoutBtn" class="logout-btn"><i data-feather="log-out"></i> Logout</button>
      </div>
    </aside>

    <div class="main-content">
      <header class="main-header">
        <div class="header-row1">
          <div class="left">
            <div class="greeting-pill" aria-live="polite">
              <span class="greeting-avatar">
                <img src="/images/greeting-icon.png" alt="Hi icon"/>
              </span>
              <div class="greet-text">
                <div class="greet-title">Hi, <span data-username="">...</span> ðŸ‘‹</div>
                <div class="greet-sub">Review & approve S.V schools orders</div>
              </div>
            </div>

            <div class="searchbar" role="search" style="margin-left:8px;">
              <i data-feather="search"></i>
              <input id="svSearch" type="search" placeholder="Search by reason or item..." aria-label="Search S.V orders"/>
            </div>
          </div>

          <div class="right topbar-right">
            <a class="account-mini" href="/account" aria-label="My account" title="My account">
              <span class="ico-circle"><img src="/images/logo.png" alt="Logo"/></span>
              <span class="label">My account</span>
            </a>
          </div>
        </div>

        <div class="header-row2">
          <h1 class="page-title">S.V schools orders</h1>
        </div>
      </header>

      <main class="page-body">
        <!-- Tabs -->
        <div id="svTabs" class="portfolio-tabs" role="tablist" aria-label="S.V Approval">
          <a class="tab-portfolio" data-tab="not-started" role="tab" aria-selected="true"
             href="/orders/sv-orders?tab=not-started">Not Started</a>
          <a class="tab-portfolio" data-tab="approved" role="tab" aria-selected="false"
             href="/orders/sv-orders?tab=approved">Approved</a>
          <a class="tab-portfolio" data-tab="rejected" role="tab" aria-selected="false"
             href="/orders/sv-orders?tab=rejected">Rejected</a>
        </div>

        <!-- Orders list (Current Orders card style) -->
<section class="card" id="sv-orders">
  <div class="co-cards" id="sv-list">
    <p><i class="loading-icon" data-feather="loader"></i> Loading orders...</p>
  </div>
</section>
      </main>
    </div>
  </div>

  <!-- ===================== S.V ORDER DETAILS MODAL ===================== -->
<div id="svOrderModal" class="co-modal-overlay" aria-hidden="true">
  <div class="co-modal-dialog" role="dialog" aria-modal="true" aria-labelledby="svModalTitle">
    <button type="button" class="co-modal-close" id="svModalClose" aria-label="Close order details">
      <i data-feather="x"></i>
    </button>

    <div class="co-modal-header">
      <div class="co-modal-head-left">
        <div class="co-modal-status" id="svModalTitle">â€”</div>
        <div class="co-modal-status-sub" id="svModalSub">â€”</div>
      </div>
    </div>

    <!-- Tracking progress (same UI as Current Orders) -->
    <div class="co-track-pill" id="svTrackPill" role="img" aria-label="Order progress">
      <div class="co-track-step" id="svStep1" title="Order Placed"><i data-feather="package"></i></div>
      <div class="co-track-conn" id="svConn1"></div>
      <div class="co-track-step" id="svStep2" title="Under Supervision"><i data-feather="eye"></i></div>
      <div class="co-track-conn" id="svConn2"></div>
      <div class="co-track-step" id="svStep3" title="In progress"><i data-feather="activity"></i></div>
      <div class="co-track-conn" id="svConn3"></div>
      <div class="co-track-step" id="svStep4" title="Shipped"><i data-feather="truck"></i></div>
      <div class="co-track-conn" id="svConn4"></div>
      <div class="co-track-step" id="svStep5" title="Arrived"><i data-feather="home"></i></div>
    </div>

    <div class="co-modal-body">
      <div class="co-modal-meta">
        <div class="co-meta-row"><span>Order ID</span><strong id="svModalOrderId">â€”</strong></div>
        <div class="co-meta-row"><span>Date</span><strong id="svModalDate">â€”</strong></div>
                <div class="co-meta-row"><span>S.V Approval status</span><strong id="svModalApproval">â€”</strong></div>
        <div class="co-meta-row"><span>Components</span><strong id="svModalComponents">â€”</strong></div>
        <div class="co-meta-row"><span>Total quantity</span><strong id="svModalTotalQty">â€”</strong></div>
        <div class="co-meta-row"><span>Estimate total</span><strong id="svModalTotalPrice">â€”</strong></div>
      </div>

      <div class="co-modal-items" id="svModalItems"></div>
    </div>
  </div>
</div>

  <script>feather.replace();</script>
  <script src="/js/common-ui.js"></script>
  <script>
    // Activate the current tab visually
    (function(){
      const tab = (new URLSearchParams(location.search).get('tab') || 'not-started').toLowerCase();
      document.querySelectorAll('#svTabs a.tab-portfolio').forEach(a => {
        const isActive = (a.dataset.tab || '').toLowerCase() === tab;
        a.classList.toggle('active', isActive);
        a.setAttribute('aria-selected', isActive ? 'true' : 'false');
        try {
          const u = new URL(a.getAttribute('href'), location.origin);
          u.searchParams.set('tab', a.dataset.tab || 'not-started');
          a.setAttribute('href', u.pathname + '?' + u.searchParams.toString());
        } catch {}
      });
    })();
  </script>
  <!-- Controller -->
  <script src="/js/sv-orders.js"></script>
</body>
</html>
