 <!DOCTYPE html>

<html lang="en">
<head>
 <link rel="manifest" href="/manifest.webmanifest" />
<meta name="theme-color" content="#ffffff" />

<link rel="icon" href="/icons/icon-192.png" />
<link rel="apple-touch-icon" href="/icons/icon-192.png" />

<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="mobile-web-app-capable" content="yes" />

<script src="/pwa-register.js" defer></script>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Operations Orders</title>
<!-- CRITICAL: Prevent sidebar links flash before CSS/permissions load -->
<style>
  body.permissions-loading .sidebar li { display: none !important; }
</style>
<link href="/css/style.css" rel="stylesheet"/>
<link href="/css/ui-redesign.css" rel="stylesheet"/>
<script src="https://unpkg.com/feather-icons"></script>
</head>
<body class="permissions-loading">
<script>
        (function() {
          try {
            if (window.innerWidth > 768 && localStorage.getItem('ui.sidebarMini') === '1') {
              document.body.classList.add('sidebar-mini');
            }
          } catch(e) {}
        })();
      </script>
<div class="app-container">
<aside class="sidebar">
<div class="sidebar-header">
<h2>Dashboard</h2>
<button aria-expanded="true" aria-label="Toggle sidebar" class="sidebar-toggle" id="sidebar-toggle">
<i data-feather="chevrons-left"></i>
</button>
</div>
<!-- Sidebar: flat links -->
<nav class="sidebar-nav">
<ul class="nav-list">
<li><a class="nav-link" href="/orders"><i data-feather="list"></i><span class="nav-label">Current Orders</span></a></li>
        <li><a class="nav-link active" href="/orders/requested"><i data-feather="users"></i><span class="nav-label">Operations Orders</span></a></li>
        <li><a class="nav-link" href="/orders/new"><i data-feather="shopping-cart"></i><span class="nav-label">Create New Order</span></a></li>
        <li><a class="nav-link" href="/stocktaking"><i data-feather="archive"></i><span class="nav-label">Stocktaking</span></a></li>
        <li><a class="nav-link" href="/orders/sv-orders"><i data-feather="award"></i><span class="nav-label">Orders Review</span></a></li>
        <li><a class="nav-link" href="/expenses"><i data-feather="dollar-sign"></i><span class="nav-label">Expenses</span></a></li>
        <li><a class="nav-link" href="/expenses/users"><i data-feather="users"></i><span class="nav-label">Expenses by User</span></a></li>
</ul>
</nav>
<div class="sidebar-footer">
<button class="logout-btn" id="logoutBtn"><i data-feather="log-out"></i> Logout</button>
</div>
</aside>
<div class="main-content">
<header class="main-header">
<div class="header-row1">
<div class="left">
<div aria-live="polite" class="greeting-pill">
<span class="greeting-avatar">
<img alt="Hi icon" src="/images/greeting-icon.png"/>
</span>
<div class="greet-text">
<div class="greet-title">Hi, <span data-username="">...</span> ðŸ‘‹</div>
<div class="greet-sub">Manage operations orders</div>
</div>
</div>
<div class="searchbar" id="req-searchbar" role="search" style="margin-left:8px;">
<i data-feather="search"></i>
<input aria-label="Search requested orders" id="requestedSearch" placeholder="Search by reason or user..." type="search"/>
</div>
</div>
<div class="right topbar-right">
<a aria-label="My account" class="account-mini" href="/account" title="My account">
<span class="ico-circle"><img alt="Logo" src="/images/logo.png"/></span>
<span class="label">My account</span>
</a>
</div>
</div>
<div class="header-row2">
<h1 class="page-title">Operations Orders</h1>
</div>
</header>
<main class="page-body">
  <!-- Tabs -->
  <div id="reqTabs" class="portfolio-tabs" role="tablist" aria-label="Requested Orders">
    <a class="tab-portfolio" data-tab="not-started" role="tab" aria-selected="true"
       href="/orders/requested?tab=not-started">Not Started</a>
    <a class="tab-portfolio" data-tab="remaining" role="tab" aria-selected="false"
       href="/orders/requested?tab=remaining">Remaining</a>
    <a class="tab-portfolio" data-tab="received" role="tab" aria-selected="false"
       href="/orders/requested?tab=received">Received</a>
    <a class="tab-portfolio" data-tab="delivered" role="tab" aria-selected="false"
       href="/orders/requested?tab=delivered">Delivered</a>
  </div>

  <!-- Orders list (Current Orders card style) -->
  <section class="card">
    <div class="co-cards" id="requested-list">
      <div class="modern-loading" role="status" aria-live="polite">
        <div class="modern-loading__spinner" aria-hidden="true"></div>
        <div class="modern-loading__text">
          Loading requested orders
          <span class="modern-loading__dots" aria-hidden="true"><span></span><span></span><span></span></span>
        </div>
      </div>
    </div>
  </section>
</main>

<!-- ===================== REQUESTED ORDER DETAILS MODAL ===================== -->
<div id="reqOrderModal" class="co-modal-overlay" aria-hidden="true">
  <div class="co-modal-dialog" role="dialog" aria-modal="true" aria-labelledby="reqModalTitle">
    <button type="button" class="co-modal-close" id="reqModalClose" aria-label="Close order details">
      <i data-feather="x"></i>
    </button>

    <div class="co-modal-header">
      <div class="co-modal-head-left">
        <div class="co-modal-status" id="reqModalTitle">â€”</div>
        <div class="co-modal-status-sub" id="reqModalSub">â€”</div>
      </div>
    </div>

    <!-- Tracking progress (same UI as Current Orders) -->
    <div class="co-track-pill" id="reqTrackPill" role="img" aria-label="Order progress">
      <div class="co-track-step" id="reqStep1" title="Order Placed"><i data-feather="package"></i></div>
      <div class="co-track-conn" id="reqConn1"></div>
      <div class="co-track-step" id="reqStep2" title="Under Supervision"><i data-feather="eye"></i></div>
      <div class="co-track-conn" id="reqConn2"></div>
      <div class="co-track-step" id="reqStep3" title="In progress"><i data-feather="activity"></i></div>
      <div class="co-track-conn" id="reqConn3"></div>
      <div class="co-track-step" id="reqStep4" title="Shipped"><i data-feather="truck"></i></div>
      <div class="co-track-conn" id="reqConn4"></div>
      <div class="co-track-step" id="reqStep5" title="Arrived"><i data-feather="home"></i></div>
    </div>

    <div class="co-modal-body">
      <div class="co-modal-meta">
        <div class="co-meta-row"><span>Reason</span><strong id="reqModalReason">â€”</strong></div>
        <div class="co-meta-row"><span>Date</span><strong id="reqModalDate">â€”</strong></div>
        <div class="co-meta-row"><span>Components</span><strong id="reqModalComponents">â€”</strong></div>
        <div class="co-meta-row"><span>Estimated cost</span><strong id="reqModalTotalPrice">â€”</strong></div>

        <!-- Extra fields shown for "Received" (and later) tabs only -->
        <div class="co-meta-row" id="reqReceiptRow" hidden>
          <span>Receipt Number</span>
          <strong id="reqModalReceiptNumber">â€”</strong>
        </div>
        <div class="co-meta-row" id="reqReceivedByRow" hidden>
          <span>Received by</span>
          <strong id="reqModalOperationsBy">â€”</strong>
        </div>
      </div>

      <div class="co-modal-actions ro-actions ro-actions--right" id="reqModalActions">
        <!-- Download dropdown (single button like Current Orders) -->
        <div class="download-menu" id="reqDownloadMenuWrap">
          <button type="button" class="ro-action-btn ro-action-btn--light download-menu__btn" id="reqDownloadMenuBtn" aria-haspopup="menu" aria-expanded="false">
            <i data-feather="download"></i>
            <span>Download</span>
            <i data-feather="chevron-down"></i>
          </button>

          <div class="download-menu__panel" id="reqDownloadMenuPanel" role="menu" aria-label="Download options" hidden>
            <button class="download-menu__item" id="reqDownloadPdfBtn" role="menuitem" type="button">
              <span>Download PDF</span>
              <i data-feather="file-text"></i>
            </button>
            <div class="download-menu__sep" role="separator"></div>
            <button class="download-menu__item" id="reqDownloadExcelBtn" role="menuitem" type="button">
              <span>Download Excel</span>
              <i data-feather="grid"></i>
            </button>
          </div>
        </div>

        <button type="button" class="ro-action-btn ro-action-btn--dark" id="reqReceivedBtn">
          <i data-feather="truck"></i>
          Received by operations
        </button>

        <button type="button" class="ro-action-btn ro-action-btn--dark" id="reqReceivedShippedBtn" style="display:none;">
          <i data-feather="check-circle"></i>
          Received
        </button>
      </div>

      <div class="co-modal-items" id="reqModalItems"></div>
    </div>
  </div>
</div>

<!-- ===================== RECEIPT NUMBER (SUB-MODAL) ===================== -->
<div id="reqReceiptModal" class="co-submodal-overlay" aria-hidden="true" hidden>
  <div class="co-submodal-dialog" role="dialog" aria-modal="true" aria-labelledby="reqReceiptTitle" aria-describedby="reqReceiptSub">
    <button type="button" class="co-submodal-close" id="reqReceiptClose" aria-label="Close">
      <i data-feather="x"></i>
    </button>

    <div class="co-submodal-header">
      <div class="co-submodal-title" id="reqReceiptTitle">Receipt Number</div>
      <div class="co-submodal-sub" id="reqReceiptSub">Enter the receipt number to confirm "Received by operations".</div>
    </div>

    <div class="co-submodal-body">
      <label class="co-submodal-label" for="reqReceiptInput">Receipt number</label>
      <input
        class="co-submodal-input"
        id="reqReceiptInput"
        type="number"
        inputmode="numeric"
        min="0"
        step="1"
        placeholder="e.g. 12345"
      />
      <div class="co-submodal-error" id="reqReceiptError" role="alert" aria-live="polite"></div>
    </div>

    <div class="co-submodal-actions">
      <button type="button" class="ro-action-btn ro-action-btn--light" id="reqReceiptCancel">Cancel</button>
      <button type="button" class="ro-action-btn ro-action-btn--dark" id="reqReceiptConfirm">Confirm</button>
    </div>
  </div>
</div>
</div>
</div>
<script>feather.replace();</script>
<script src="/js/common-ui.js"></script>
<script src="/js/requested-orders.js"></script>
</body>
</html>
